"use strict";(self.webpackChunkbeauty_docs=self.webpackChunkbeauty_docs||[]).push([[9261],{1251:(e,n,c)=>{c.r(n),c.d(n,{assets:()=>t,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"Advanced/caches","title":"Cache System","description":"Beauty Framework provides a fast, PSR-16 compliant cache abstraction layer with support for multiple backends and easy configuration via config/cache.php.","source":"@site/docs/3-Advanced/caches.md","sourceDirName":"3-Advanced","slug":"/Advanced/caches","permalink":"/docs/Advanced/caches","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Jobs System","permalink":"/docs/Advanced/jobs"},"next":{"title":"Local Process Management","permalink":"/docs/Advanced/processes"}}');var i=c(4848),s=c(8453);const a={sidebar_position:4},l="Cache System",t={},d=[{value:"\ud83e\uddf1 Basic Usage",id:"-basic-usage",level:2},{value:"\u2699\ufe0f Supported Drivers",id:"\ufe0f-supported-drivers",level:2},{value:"\ud83d\udd27 Custom Cache Driver",id:"-custom-cache-driver",level:2},{value:"\ud83d\udee0 Configuration Loader",id:"-configuration-loader",level:2},{value:"\ud83d\udca1 Available Cache Methods",id:"-available-cache-methods",level:2},{value:"\ud83d\udd17 Repository",id:"-repository",level:2},{value:"\u2705 Summary",id:"-summary",level:2}];function o(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"cache-system",children:"Cache System"})}),"\n",(0,i.jsxs)(n.p,{children:["Beauty Framework provides a fast, PSR-16 compliant cache abstraction layer with support for multiple backends and easy configuration via ",(0,i.jsx)(n.code,{children:"config/cache.php"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"-basic-usage",children:"\ud83e\uddf1 Basic Usage"}),"\n",(0,i.jsxs)(n.p,{children:["Any service can use caching by injecting ",(0,i.jsx)(n.code,{children:"Psr\\SimpleCache\\CacheInterface"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use Psr\\SimpleCache\\CacheInterface;\n\nclass UserService\n{\n    public function __construct(\n        private CacheInterface $cache,\n    ) {}\n\n    public function getData(): string\n    {\n        $data $this->cache->get('key');\n\n        if (!$data) {\n            $this->cache->set('key', 'value', 3600)\n        }\n\n        return $data ?? 'value';\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\ufe0f-supported-drivers",children:"\u2699\ufe0f Supported Drivers"}),"\n",(0,i.jsxs)(n.p,{children:["Caching behavior is configured in ",(0,i.jsx)(n.code,{children:"config/cache.php"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",metastring:'title="config/cache.php"',children:"return [\n    'default' => env('CACHE_DRIVER', 'redis'),\n\n    'stores' => [\n        'redis' => [...],\n        'roadrunner-kv' => [...],\n        'array' => [...],\n        'file' => [...],\n        'memory' => [...],\n    ],\n];\n"})}),"\n",(0,i.jsx)(n.p,{children:"Available drivers:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"redis"})," \u2014 via native Redis extension"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"roadrunner-kv"})," \u2014 integration with ",(0,i.jsx)(n.a,{href:"https://docs.roadrunner.dev/docs/key-value/overview-kv",children:"RoadRunner KV plugin"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"array"})," \u2014 in-memory array cache"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"file"})," \u2014 filesystem-based cache"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"memory"})," \u2014 LRU memory cache with configurable size"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["\ud83d\udc49 See full configuration options: ",(0,i.jsx)(n.a,{href:"/docs/Installation/Configs/cache",children:(0,i.jsx)(n.code,{children:"Configs/\u0421ache"})})]}),"\n",(0,i.jsx)(n.h2,{id:"-custom-cache-driver",children:"\ud83d\udd27 Custom Cache Driver"}),"\n",(0,i.jsx)(n.p,{children:"Memcached for example"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use Memcached;\nuse Psr\\SimpleCache\\CacheInterface;\n\nclass Memcache implements CacheInterface\n{\n    public function __construct(private Memcached $memcached) {}\n\n    public function get(string $key, mixed $default = null): mixed {\n        $value = $this->memcached->get($key);\n        return $value === false ? $default : $value;\n    }\n\n    public function set(string $key, mixed $value, $ttl = null): bool {\n        return $this->memcached->set($key, $value, $ttl ?? 0);\n    }\n\n    public function delete(string $key): bool {\n        return $this->memcached->delete($key);\n    }\n\n    public function clear(): bool {\n        return $this->memcached->flush();\n    }\n\n    public function getMultiple(iterable $keys, mixed $default = null): iterable {\n        $results = [];\n        foreach ($keys as $key) {\n            $results[$key] = $this->get($key, $default);\n        }\n        return $results;\n    }\n    public function setMultiple(iterable $values, $ttl = null): bool {\n        foreach ($values as $key => $value) {\n            if (!$this->set($key, $value, $ttl)) return false;\n        }\n        return true;\n    }\n\n    public function deleteMultiple(iterable $keys): bool {\n        foreach ($keys as $key) {\n            if (!$this->delete($key)) return false;\n        }\n        return true;\n    }\n\n    public function has(string $key): bool {\n        return $this->memcached->get($key) !== false;\n    }\n}\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use Beauty\\Cache\\Driver\\CacheDriverInterface;\nuse Psr\\SimpleCache\\CacheInterface;\nuse Memcached;\n\nclass MemcachedCacheDriver implements CacheDriverInterface\n{\n    public function supports(string $driver): bool\n    {\n        return $driver === 'memcached';\n    }\n\n    public function make(array $config): CacheInterface\n    {\n        $memcached = new Memcached();\n        $memcached->addServer($config['host'] ?? '127.0.0.1', $config['port'] ?? 11211);\n\n        return new Memcache($memcached);\n    }\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["And registry in ",(0,i.jsx)(n.code,{children:"config/cache.php"})," in ",(0,i.jsx)(n.code,{children:"stores"})," section:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",metastring:'title="config/cache.php"',children:"return [\n    'default' => env('CACHE_DRIVER', 'redis'),\n    'stores' => [\n        'memcached' => [\n            'driver' => 'memcached',\n            'host' => env('MEMCACHED_HOST', '127.0.0.1'),\n            'port' => env('MEMCACHED_PORT', 11211),\n        ],\n    ];\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Add ",(0,i.jsx)(n.code,{children:"App\\Container\\Cache"})," in factory:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",metastring:'title="app/Container/Cache.php"',children:"        $factory = new CacheFactory([\n            new RedisCacheDriver(),\n            new KVCacheDriver(),\n            new ArrayCacheDriver(),\n            new FileCacheDriver(),\n            new LruCacheDriver(),\n            new MemcachedCacheDriver(), // <- this\n        ]);\n"})}),"\n",(0,i.jsxs)(n.p,{children:["For example - watch ",(0,i.jsx)(n.code,{children:"Tarantool"})," driver in this repo - ",(0,i.jsx)(n.a,{href:"https://github.com/beauty-framework/tarantool-support",children:"https://github.com/beauty-framework/tarantool-support"})]}),"\n",(0,i.jsx)(n.h2,{id:"-configuration-loader",children:"\ud83d\udee0 Configuration Loader"}),"\n",(0,i.jsx)(n.p,{children:"The configuration binding for the cache system is registered in:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"App\\Container\\Cache\n"})}),"\n",(0,i.jsxs)(n.p,{children:["This class reads the settings from ",(0,i.jsx)(n.code,{children:"config/cache.php"})," and binds the proper cache implementation."]}),"\n",(0,i.jsx)(n.p,{children:"In addition, the container pre-binds the following for direct access:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"\\Redis::class"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"\\Spiral\\RoadRunner\\KeyValue\\Factory::class"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"You can use them in your services if you need lower-level access."}),"\n",(0,i.jsx)(n.h2,{id:"-available-cache-methods",children:"\ud83d\udca1 Available Cache Methods"}),"\n",(0,i.jsxs)(n.p,{children:["The following methods are supported from ",(0,i.jsx)(n.code,{children:"CacheInterface"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"get(string $key, mixed $default = null): mixed"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"set(string $key, mixed $value, null|int|DateInterval $ttl = null): bool"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"delete(string $key): bool"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"has(string $key): bool"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"clear(): bool"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"getMultiple(array $keys, mixed $default = null): iterable"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"setMultiple(iterable $values, null|int|DateInterval $ttl = null): bool"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"deleteMultiple(iterable $keys): bool"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"-repository",children:"\ud83d\udd17 Repository"}),"\n",(0,i.jsxs)(n.p,{children:["Cache are implemented in the ",(0,i.jsx)(n.code,{children:"beauty-framework/cache"})," package (already connected in the framework):"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://github.com/beauty-framework/cache",children:"https://github.com/beauty-framework/cache"})}),"\n",(0,i.jsx)(n.h2,{id:"-summary",children:"\u2705 Summary"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Use PSR-16 ",(0,i.jsx)(n.code,{children:"CacheInterface"})," for caching"]}),"\n",(0,i.jsxs)(n.li,{children:["Easily switch between drivers in ",(0,i.jsx)(n.code,{children:"config/cache.php"})]}),"\n",(0,i.jsx)(n.li,{children:"Redis is recommended for production"}),"\n",(0,i.jsx)(n.li,{children:"RoadRunner KV plugin is supported"}),"\n",(0,i.jsx)(n.li,{children:"Full support for TTLs, tags (if implemented), and multiple store backends"}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["For advanced usage and driver extension, check the configuration doc: ",(0,i.jsx)(n.a,{href:"/docs/Installation/Configs/cache",children:(0,i.jsx)(n.code,{children:"Configs/\u0421ache"})})]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},8453:(e,n,c)=>{c.d(n,{R:()=>a,x:()=>l});var r=c(6540);const i={},s=r.createContext(i);function a(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);